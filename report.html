<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Training Report</title>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>
  <style>
    /* Landscape PDF */
    @page { size: landscape; margin:0; }
    @media print {
      body { width: 100vw; height: 100vh; }
      .section-banner { page-break-after: always; height:100vh; }
    }

    body { margin:0; padding:0; font-family:'Segoe UI',sans-serif; color:#333; background:#fff; }
    .page-header { display:flex; align-items:center; padding:20px 30px; }
    .page-header img { height:40px }
    .page-header .line { flex:1; height:1px; background:#40a3a3; margin-left:20px }

    /* Section banner */
    .section-banner {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: #f0f8f9;
      padding: 40px;
      box-sizing: border-box;
      height: 100vh;
    }
    .section-banner h1 {
      margin: 0 0 20px;
      font-size: 64px;
      color: #007c91;
    }
    .section-banner p {
      margin: 8px 0;
      font-size: 24px;
      color: #555;
    }

    /* Charts and text */
    #reportContent { padding: 0; }
    .chart-container { width: 90vw; height: 400px; margin: 40px auto; }
    .turma-title {
      font-size: 28px; font-weight:bold;
      text-align:center; margin-top: 40px; color:#007c91;
    }
    .text-question {
      border:1px solid #007c91; border-left:6px solid #007c91;
      padding:16px; margin: 20px auto; background:#f9f9f9;
      width: 90vw; box-sizing:border-box;
    }
    .text-question-title {
      font-weight:bold; margin-bottom:8px;
      font-size:20px; color:#007c91;
    }
    ul { padding-left:20px; font-size:16px; }
  </style>
</head>
<body>
  <div class="page-header">
    <img src="mind4time-logo.png" alt="MIND4TIME" />
    <div class="line"></div>
  </div>
  <div id="reportContent"></div>

  <script>
    // Helpers (same as before)...
    function groupBy(arr,key){return arr.reduce((a,i)=>(a[i[key]]||(a[i[key]]=[])).push(i)&&a,{})}
    function createAverages(rows){ /* numeric average logic if needed */ }
    // but we only need counts here

    async function loadReport(){
      const f=JSON.parse(localStorage.getItem('reportFilters')||'{}');
      const [data,meta] = await Promise.all([
        fetch('https://fidalgom4t.github.io/reportfinal/data.json').then(r=>r.json()),
        fetch('https://fidalgom4t.github.io/reportfinal/meta.json').then(r=>r.json())
      ]);
      const out=document.getElementById('reportContent');
      out.innerHTML='';

      (f.programs||[]).forEach(prog=>{
        // filter all rows for this program
        const rowsAll = data.filter(d=>
          (f.clients||[]).includes(d.client) &&
          d.program===prog &&
          (f.turmas||[]).includes(d.turma)
        );

        ['assessment','evaluation'].forEach(sec=>{
          const secName = sec==='assessment' ? 'Assessment' : 'Avaliação do Programa';
          // count distinct respondent_ids
          const uniq = new Set(rowsAll
            .filter(d=>String(d.section||'').toLowerCase().includes(sec))
            .map(d=>d.respondent_id||d.id)
          ).size;

          // Section banner
          const sb=document.createElement('div');
          sb.className='section-banner';
          sb.innerHTML = `
            <h1>${secName}</h1>
            <p>Total de respostas: ${uniq}</p>
          `;
          out.appendChild(sb);

          // After banner, render charts/text if desired (optional)
          // ...
        });
      });
    }

    document.addEventListener('DOMContentLoaded',loadReport);
  </script>
</body>
</html>
