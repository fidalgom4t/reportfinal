<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controlo de Relatórios</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
      background-color: #fff;
      color: #333;
    }
    header {
      display: flex;
      align-items: center;
      border-bottom: 2px solid #007c91;
      padding-bottom: 10px;
      margin-bottom: 30px;
    }
    .logo-text {
      font-size: 20px;
      font-weight: bold;
      color: #007c91;
      margin-left: 15px;
    }
    .section {
      border: 1px solid #007c91;
      padding: 20px;
      margin-bottom: 30px;
    }
    select, input[type="text"] {
      margin: 5px;
      padding: 5px;
    }
    button {
      padding: 10px 20px;
      background-color: #007c91;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo" height="50">
    <div class="logo-text">MIND4TIME<br><span style="font-weight: normal; font-size: 14px;">Productivity Consulting</span></div>
  </header>

  <h1>Painel de Controlo</h1>

  <div class="section">
    <label>Clientes:</label><br>
    <select id="clientSelect" multiple size="5"></select><br>

    <label>Programas:</label><br>
    <select id="programSelect" multiple size="5"></select><br>

    <label>Turmas:</label><br>
    <select id="turmaSelect" multiple size="5"></select><br>

    <label>Formador (por programa):</label><br>
    <input type="text" id="trainerInput" placeholder="Nome do formador">
    
    <br><br>
    <button onclick="generateReport()">Gerar Relatório</button>
  </div>

  <script>
    let rawData = [];

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        rawData = data;
        populateFilters();
      });

    function populateFilters() {
      const clients = [...new Set(rawData.map(d => d.client))].sort();
      fillSelect('clientSelect', clients);
      fillSelect('programSelect', []);
      fillSelect('turmaSelect', []);

      document.getElementById('clientSelect').addEventListener('change', updatePrograms);
      document.getElementById('programSelect').addEventListener('change', updateTurmas);
    }

    function fillSelect(id, values) {
      const select = document.getElementById(id);
      select.innerHTML = '';
      values.forEach(val => {
        const opt = document.createElement('option');
        opt.value = val;
        opt.textContent = val;
        select.appendChild(opt);
      });
    }

    function getSelectedValues(id) {
      return Array.from(document.getElementById(id).selectedOptions).map(o => o.value);
    }

    function updatePrograms() {
      const selectedClients = getSelectedValues('clientSelect');
      const filtered = rawData.filter(d => selectedClients.includes(d.client));
      const programs = [...new Set(filtered.map(d => d.program))].sort();
      fillSelect('programSelect', programs);
      updateTurmas();
    }

    function updateTurmas() {
      const selectedClients = getSelectedValues('clientSelect');
      const selectedPrograms = getSelectedValues('programSelect');
      const filtered = rawData.filter(d => selectedClients.includes(d.client) && selectedPrograms.includes(d.program));
      const turmas = [...new Set(filtered.map(d => d.turma))].sort();
      fillSelect('turmaSelect', turmas);
    }

    function generateReport() {
      const clients = getSelectedValues('clientSelect');
      const programs = getSelectedValues('programSelect');
      const turmas = getSelectedValues('turmaSelect');
      const trainer = document.getElementById('trainerInput').value;

      const query = new URLSearchParams({
        client: clients.join(','),
        program: programs.join(','),
        turma: turmas.join(','),
        trainer
      });

      window.location.href = `index.html?${query.toString()}`;
    }
  </script>
</body>
</html>
